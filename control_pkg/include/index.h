#ifndef INDEX_H
#define INDEX_H

// 常数
constexpr double pi = 3.1415926535;
constexpr double g = 9.815;

// 控制系统
constexpr double CONTROL_RATE = 250;
constexpr double PLAN_RATE = 10;
constexpr double TIME_STEP = 1.0 / CONTROL_RATE;
constexpr double nl_index = 1;
// 限幅参数
constexpr double nono = 1;
constexpr double hip_protect = 1;
constexpr double wheel_protect = 1;
constexpr double hip_limit = 6;
constexpr double foot_limit = 4;

// 时间参数 time除以TIME_STEP可得count
constexpr double init_time = 0.5;
constexpr double jump_time = 0.3;

// 质量参数
constexpr double m_wheel = 0.3871;
constexpr double m_body = 8.2584;
constexpr double m_l = 1.854;

// 结构参数
constexpr double L1 = 0.141;                // 大腿;
constexpr double L2 = 0.2485;               // 小腿;
constexpr double L3 = 0.2485;               // 小腿;
constexpr double L4 = 0.141;                // 大腿;
constexpr double L5 = 0.120;                // 髋关节电机转轴之间的距离;
constexpr double L6 = 0;                    // 足端;
constexpr double radius = 0.152 / 2;        // 半径;
constexpr double half_wheel_d = 0.4716 / 2; // 驱动轮【左右】轮距/2
constexpr double wheel_d = 0.5674;          // 驱动轮【前后】轮距
constexpr double c_orignal = 0.5674 / 2;    // 驱动轮【前后】轮距/2
constexpr double a = 0.2358;                // 驱动轮【左右】轮距/2
constexpr double xs = L5 / 2 - 0.04;        // 步态起点
constexpr double xf = L5 / 2 + 0.04;        // 步态终点
constexpr double h = 0.15;

// 其他参数
constexpr double off_ground_F = 30;  // 判断脱离地面的支持力阈值
constexpr double jump_length = 0.07; // 跳跃时腿长的增量
/////俯视图/////
// 146      145//   phi4
//      前     //
// 142 (轮) 141//
//      后     //
// 144      143//   phi1
////////////////
// 设备
#define phi_144 lleg->phi1
#define phi_146 lleg->phi4
#define dphi_144 lleg->dphi1
#define dphi_146 lleg->dphi4
#define phi_143 rleg->phi1
#define phi_145 rleg->phi4
#define dphi_143 rleg->dphi1
#define dphi_145 rleg->dphi4
// 1500, 0, 2800
// 1000,2,2000
double l0_pid_index[3] = {800, 2, 1000};       // 600 2 800
double theta_pid_index[3] = {4.5, 0.0001, 40}; // 3.5 0 35
double turn_pid_index[3] = {0.04, 0, 3.6};     // 0.04 0 3.6
double roll_pid_index[3] = {2, 0, 0};
double COMB_roll_pid_index[3] = {0.007, 0, 0.02};
double COMB_pitch_pid_index[3] = {0.008, 0, 0.02};
double COMB_x_pid_index[3] = {1100, 0.6, 3500};
double COMB_z_pid_index[3] = {600, 1, 3000};

double COMB_turn_pid_s_index[3] = {4.0, 0, 2};
double COMB_turn_pid_m_index[3] = {4.0, 0, 2};
double COMB_recover_pid_s_index[3] = {4.0, 0.0005, 2};
double COMB_recover_pid_m_index[3] = {4.0, 0.0005, 2};
double K_roll = 1;
double K_pitch = 1;
int climb_flag = 0; // 爬坡标志

// Turning Setting 20241013
constexpr double turn_L1 = 0.2;
constexpr double turn_L2 = 0.381;
double R_f, R_b;

double lowest_leg_length = 0.09;
double highest_leg_length = 0.38;

int COMB_mode = 1; // 1:力位混合控制，0:位置开环

// trot步态参数
double t = 0;
double Ts = 0.3;     // 步态周期
double lambda = 0.5; // 占空比

double lqr_index[12][4] =
    {
        // {17.0648, 21.7671, -43.9466, -2.2676},
        // {390.936, -381.0747, 118.1754, 5.1945},
        // {13.444, -11.5278, -2.6294, -0.25435},
        // {16.1034, -21.6239, 10.0932, 0.89053},
        // {13.0357, -4.023, -3.1592, -0.76791},
        // {72.9683, -51.8741, 3.2642, 5.4681},
        // {19.823, -8.9119, -3.0308, -1.1367},
        // {73.7976, -51.7478, 1.9069, 6.6409},
        // {-9.7942, 14.4002, -11.5262, 5.8204},
        // {21.5438, -67.901, 50.7546, -2.2222},
        // {-2.9057, 2.9176, -1.6523, 0.99536},
        // {-2.1754, -6.0758, 7.1075, -0.71933},
        // // Q=[0.01 0.1 5 2 5 0.01 ]
        // // R=[1 0.1]
        // // T=0.004
        // // RadiusOfWheel=0.075

        // old
        //  {7.5696, 25.4792, -44.7344, -2.6009},
        //  {360.0345, -357.8524, 117.645, 4.2121},
        //  {11.1576, -10.0704, -3.4152, -0.28789},
        //  {16.9318, -21.7653, 9.9313, 0.83598},
        //  {24.2554, -13.7121, -0.46299, -1.8634},
        //  {110.0561, -80.7346, 8.8302, 6.2159},
        //  {29.2184, -18.6081, 0.35259, -2.1474},
        //  {92.4896, -67.0435, 6.0558, 6.2803},
        //  {-29.9469, 34.0301, -19.0356, 7.8786},
        //  {-0.043815, -52.3916, 49.3807, -1.0401},
        //  {-4.9831, 4.7488, -2.1299, 1.1892},
        //  {-10.4256, 1.7057, 4.694, -0.49114},
        //  // Q=[0.1 0.1 10 2 5 0.01 ]
        //  // R=[1 0.1]
        //  // T=0.004
        //  // RadiusOfWheel=0.075

        // new
        {38.6026, -0.60491, -38.9041, -1.7833},
        {325.8431, -354.0639, 125.5775, 5.759},
        {4.006, -6.3933, -3.4018, -0.058591},
        {15.7337, -23.0541, 12.1403, 0.6966},
        {7.502, 3.7692, -7.8417, -0.43208},
        {127.7172, -98.3601, 12.9007, 7.2747},
        {7.9546, 1.4053, -7.1646, -0.72935},
        {115.3858, -88.1584, 11.0595, 7.1442},
        {29.3362, -16.8799, -4.1167, 6.5327},
        {-60.8014, -22.5111, 53.8815, -3.9823},
        {6.7648, -4.6626, 0.20399, 1.1588},
        {-25.7738, 8.3632, 6.6351, -1.0279},
        // Q=[0.5 0.1 10 2 5 0.01 ]
        // R=[1 0.1]
        // T=0.004
        // RadiusOfWheel=0.076

        //  {2.2658, 34.4844, -45.7174, -1.4157},
        //  {361.1624, -347.738, 105.051, 5.3394},
        //  {11.6429, -9.6047, -2.8236, -0.15849},
        //  {19.4091, -24.2366, 10.5962, 0.55724},
        //  {-1.8733, 9.238, -7.1527, -0.36459},
        //  {48.5753, -28.4945, -4.772, 6.4984},
        //  {1.5894, 6.3958, -7.1049, -0.57844},
        //  {44.8035, -25.9629, -5.2796, 6.8211},
        //  {8.1735, -0.59941, -7.2777, 5.2175},
        //  {76.6121, -115.4771, 63.897, -3.5527},
        //  {1.1928, -0.5105, -0.72503, 0.88746},
        //  {8.3758, -15.5504, 9.9399, -0.99273},
        //  // Q=[0.01 0.01 5 1 5 0.01 ]
        //  // R=[1 0.1]
        //  // T=0.004
        //  // RadiusOfWheel=0.075
};
#endif
/*这个凑合还行
{-69.9539,81.5995,-39.8253,-0.58697},
{136.6819,-110.0697,22.7466,2.5835},
{3.244,-2.12,-1.8233,-0.088309},
{7.1556,-6.9964,2.1596,0.19998},
{-8.429,9.2403,-3.7128,-0.093171},
{1.4646,3.046,-3.953,1.4483},
{-8.3918,9.6,-4.2151,-0.16648},
{0.96411,4.0558,-4.7105,1.7285},
{0.74638,1.5579,-2.0201,0.73998},
{18.0282,-19.2429,7.4622,0.25481},
{-0.37749,0.74831,-0.53706,0.17763},
{4.5582,-4.726,1.7873,-0.028335},
//Q=[0.0001 0.0001 0.5 0.01 0.5 0.001 ]
//R=[1 0.25]
//T=0.004
//RadiusOfWheel=0.075
*/
// 没装机械臂的参数：
//  {-57.8424, 71.858, -43.1608, -1.1325},
//  {234.7896, -191.7027, 42.41, 4.2288},
//  {6.7116, -5.9119, -2.3464, -0.13416},
//  {18.7808, -18.3585, 6.0996, 0.31987},
//  {-17.3695, 20.298, -8.5919, -0.71461},
//  {5.5184, 16.1668, -18.6871, 6.3907},
//  {-9.1483, 12.6586, -6.913, -0.7776},
//  {4.9666, 12.2504, -14.9303, 5.4708},
//  {2.4078, 4.9881, -6.1731, 2.1448},
//  {60.0999, -67.0732, 26.9664, 2.4865},
//  {-1.1856, 1.8519, -1.1296, 0.33168},
//  {10.4459, -11.0145, 4.2118, -0.042454},
//  // Q=[0.001 0.001 5 1 5 0.01 ]
//  // R=[1 0.1]
//  // T=0.004
//  // RadiusOfWheel=0.075